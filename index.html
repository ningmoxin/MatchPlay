<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MatchPlay - è–èª•äº¤æ›ç¦®ç‰©é…å°</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <!-- æ¨™é¡Œå€ -->
    <header class="header">
      <h1>ğŸ„ MatchPlay ğŸ„</h1>
      <p class="subtitle">è–èª•äº¤æ›ç¦®ç‰©é…å°ç³»çµ±</p>
    </header>

    <!-- å…¥å£æŒ‰éˆ• -->
    <div class="entry-buttons">
      <a href="admin.html" class="entry-btn btn-primary">
        <div class="icon">ğŸ…</div>
        <div class="label">ç®¡ç†è€…</div>
      </a>
      <a href="viewer.html" class="entry-btn btn-secondary">
        <div class="icon">ğŸ‘€</div>
        <div class="label">è§€çœ¾</div>
      </a>
    </div>

    <!-- QR Code å€åŸŸ -->
    <div class="card">
      <h2>ğŸ“± æƒæåŠ å…¥è§€çœ‹</h2>
      <div class="qr-container">
        <div id="qrcode"></div>
        <p style="margin-top: 15px; color: #666;">æƒæ QR Code åœ¨æ‰‹æ©Ÿä¸ŠåŒæ­¥è§€çœ‹é…å°æ­æ›‰</p>
      </div>
    </div>

    <!-- ç›®å‰ç‹€æ…‹ -->
    <div class="card">
      <h2>ğŸ“Š ç›®å‰ç‹€æ…‹</h2>
      <div id="status-display">
        <p>è¼‰å…¥ä¸­...</p>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <!-- QR Code ç”¢ç”Ÿå™¨ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <!-- å…±ç”¨è¨­å®š -->
  <script src="js/firebase-config.js"></script>

  <script>
    // ç”¢ç”Ÿ QR Code
    function generateQRCode() {
      // è™•ç† URLï¼šå¦‚æœæ˜¯æ ¹ç›®éŒ„å‰‡åŠ ä¸Š viewer.htmlï¼Œå¦å‰‡æ›¿æ› index.html
      let viewerUrl = window.location.href;
      if (viewerUrl.endsWith('/')) {
        viewerUrl += 'viewer.html';
      } else if (viewerUrl.includes('index.html')) {
        viewerUrl = viewerUrl.replace('index.html', 'viewer.html');
      } else {
        viewerUrl = viewerUrl.replace(/\/?$/, '/viewer.html');
      }

      const qrContainer = document.getElementById('qrcode');
      qrContainer.innerHTML = ''; // æ¸…ç©ºå®¹å™¨

      try {
        // ä½¿ç”¨ qrcodejs library
        new QRCode(qrContainer, {
          text: viewerUrl,
          width: 200,
          height: 200,
          colorDark: '#165b33',
          colorLight: '#ffffff',
          correctLevel: QRCode.CorrectLevel.H
        });
      } catch (error) {
        console.error('QR Code éŒ¯èª¤:', error);
        qrContainer.innerHTML = '<p style="color: #999;">QR Code ç”¢ç”Ÿå¤±æ•—</p>';
      }
    }

    // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
    function updateStatusDisplay(state) {
      const statusDiv = document.getElementById('status-display');

      const statusMap = {
        'waiting': { text: 'ç­‰å¾…ä¸­', class: 'status-waiting', icon: 'â³' },
        'pairing': { text: 'é…å°ä¸­', class: 'status-pairing', icon: 'ğŸ”„' },
        'revealing': { text: 'æ­æ›‰ä¸­', class: 'status-revealing', icon: 'ğŸ' },
        'finished': { text: 'å·²å®Œæˆ', class: 'status-finished', icon: 'âœ…' }
      };

      const status = statusMap[state.status] || statusMap['waiting'];

      statusDiv.innerHTML = `
        <span class="status-badge ${status.class}">
          ${status.icon} ${status.text}
        </span>
      `;
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // ç”¢ç”Ÿé›ªèŠ±æ•ˆæœ
      createSnowflakes();

      // ç”¢ç”Ÿ QR Code
      generateQRCode();

      // ç›£è½ç‹€æ…‹è®ŠåŒ–
      onGameStateChange(updateStatusDisplay);
    });
  </script>
</body>
</html>
